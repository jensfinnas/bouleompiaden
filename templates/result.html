<p class="lead">
  {{player1.name}} har <strong>{{'%0.f'| format(player1.win_prob*100|float)}} procents chans</strong> att vinna över {{player2.name}}.
</p>
<p>
  När vi simulerar {{n_games}} matcher vinner {{winner.name}} {{winner.wins|int}} gånger. Den mest troliga segermarginalen är {{most_likely_diff|float|abs|int}} poäng.
</p>
<p>
  Följande graf visar sannolikheten för olika poängmarginaler (givet att matchen går till 8 poäng).
</p>

<div id="result-chart"></div>
<script type="text/javascript">
var diff_counts = {{diff_counts}};
var categories = diff_counts.map(function(d) { return Math.abs(d[0])})
var p1_wins = diff_counts.map(function(d) { return d[0] > 0 ? d[1] : 0})
var p2_wins = diff_counts.map(function(d) { return d[0] < 0 ? d[1] : 0})

Highcharts.chart('result-chart', {
  chart: {
    "type": "column",
    height: 250
  },
  title:{
      text:''
  },
  xAxis: {
    categories: categories,
    reversed: true,
    title: "Segermarginal (poäng)"
  },
  yAxis: {
    min: 0,
    title: ""
  },
  plotOptions: {
    column: {
      pointPadding: 0,
      borderWidth: 0,
      groupPadding: 0,
      shadow: false,
      grouping: false
    }
  },
  tooltip: {
    formatter:function(){
        if(this.point.y > 0) {
          var points = Math.abs(categories[this.point.x])
          var n = this.point.y;
          return this.series.name + " med " + points + " poäng " + n + " gånger av {{n_games}}."
        }
        else {
          return ''
        }
      }

  },
  series: [{
    name: '{{player1.name}} vinner',
    color: '#EB6864',
    data: p1_wins
  },
  {
    name: '{{player2.name}} vinner',
    color: '#6d64eb',
    data: p2_wins
  }]
});
</script>

<hr>
<h4>Statistik från tidigare år</h4>
<table class="table">
  <thead>
    <tr>
      <th></th>
      <th>{{player1.name}}</th>
      <th>{{player2.name}}</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Antal matcher</th>
      <td class="text-right">{{player1.n_games|int}}</td>
      <td class="text-right">{{player2.n_games|int}}</td>
    </tr>
    <tr>
      <th>Antal vinster</th>
      <td class="text-right">{{player1.historical_wins|int}}</td>
      <td class="text-right">{{player2.historical_wins|int}}</td>
    </tr>
    <tr>
      <th>Vinstprocent</th>
      <td class="text-right">{{'%0.f'| format(player1.historical_win_rate * 100|float)}} %</td>
      <td class="text-right">{{'%0.f'| format(player2.historical_win_rate * 100|float)}} %</td>
    </tr>
    <tr>
      <th>Tidigare turneringar</th>
      <td class="text-right">{{player1.years|join(', ')}}</td>
      <td class="text-right">{{player2.years|join(', ')}}</td>

    </tr>
  </tbody>
</table>

{% if previous_games|length == 0 %}
 <p>
   {{player1.name}} och {{player2.name}} har aldrig mötts tidigare i Bouleympiaden.
 </p>

{% else %}
  <p>
    {{player1.name}} och {{player2.name}} har mötts
    {% if previous_games|length == 1 %}
    en gång
    {% else %}
    {{previous_games|length}} gånger
    {% endif %}
    tidigare i Bouleympiaden.
  </p>

  <table class="table">
    <thead>
      <tr>
        <th></th>
        <th>{{player1.name}}</th>
        <th>{{player2.name}}</th>
      </tr>
    </thead>
    <tbody>
      {% for game in previous_games  %}

        <tr>
          <th>{{game.year}}</th>
          <td class="text-right">
            {{game.p1_score|int}} poäng</td>
          <td class="text-right">{{game.p2_score|int}} poäng</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endif %}
<h4
